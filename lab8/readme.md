# Лабораторная 8

### Как запустить проект?
* Устанавливаем [php](https://www.php.net/)
* Устанавливаем [сomposer](https://getcomposer.org/)
1. Заходим в папку с нашим проектом 
2. Прописываем в консоль: php -S localhost:80 _(название файла)_
3. Переходим по ссылке в консоли

#### **Описание**
В этом проекте я организую структуру папок, создавая отдельные категории для представлений, компонентов, форм и комментариев, а также выделяю специальный файл для обработки данных форм. Все созданные элементы интегрирую в _index.php_ с использованием команд *include* и *require*. Кроме того, был разработан класс *Page* с методом *part*, который упрощает интеграцию отдельных .php файлов (компонентов) в другие страницы.
#### **Краткая документация**
* `include()` - включает и выполняет указанный файл во время выполнения скрипта. Если файл не найден, include генерирует предупреждение, но скрипт продолжает выполнение. 
* `include_once()` - так же включает и выполняет указанный файл во время выполнения скрипта, однако файл будет включен только один раз, даже если он вызывается несколько раз в коде.
* `require()` -  аналогична функции _include_, но с одним отличием: если файл не найден, она генерирует фатальную ошибку (E_COMPILE_ERROR) и останавливает выполнение скрипта.
* `require_once()` - аналогична функции require, но также гарантирует, что файл будет включен только один раз, даже если он вызывается несколько раз в коде. 
* `Page::part()` - вызов статического метода _part()_ класса _Page_ с использованием синтаксиса _Page::part()_. Этот метод ожидает один аргумент - имя файла.

#### **Использование сайта**
1. В index.php передаю форму и комментарии при помощи include:
```php
        <?php include('views/components/form.php'); ?>

        <?php include('views/components/comments.php'); ?>
```

2. При помощи класса Page подключаю наши header и footer:
```php
<?php Page::part('views/header'); ?>
...
<?php Page::part('views/footer'); ?>
```

3. Данный фрагмент кода обрабатывает отправленную форму комментария: если данные проходят проверку, они добавляются в файл comments.txt, и пользователь перенаправляется на главную страницу. Если данные не проходят проверку, выводятся сообщения об ошибках.
```php
<?php
   $errors = validateCommentData($name, $comment);

    if (empty($errors)) {
        // Сохранение данных в файл
        $file = fopen("comments.txt", "a");
        fwrite($file, "Name: $name\nComment: $comment\n\n");
        fclose($file);

        header("Location: ../index.php");
    } else {
        
        foreach ($errors as $error) {
            echo "<p>$error</p>";
        }
    }
```

4. Этот фрагмент кода проверяет отправленные пользователем данные на соответствие определенным критериям перед их дальнейшей обработкой:
```php
<?php
function validateCommentData($name, $comment) {
    $errors = array();

    // Проверка наличия обязательных полей
    if (empty($name)) {
        $errors[] = "Заполните все поля.";
    }

    if (empty($comment)) {
        $errors[] = "Заполните все поля.";
    }

    // Проверка минимальной длины комментария (например, 10 символов)
    if (strlen($comment) < 10) {
        $errors[] = "Комментарий должен быть длиной не менее 10 символов.";
    }

    return $errors;
}	
```

5. Данный код сначала читает содержимое файла "handlers/comments.txt", предполагая, что комментарии разделены двойным переносом строки. Затем он разбивает содержимое файла на отдельные комментарии и для каждого из них извлекает имя и текст, удаляя соответствующие префиксы. Далее он выводит каждый комментарий в формате HTML-блока с классом "comment", отображая имя и текст:
```php
<?php
        $comments = file_get_contents("handlers/comments.txt");
        $comments_array = explode("\n\n", $comments);

        foreach ($comments_array as $comment) {
            if (!empty($comment)) {
                $comment_parts = explode("\n", $comment);
                $name = str_replace("Name: ", "", $comment_parts[0]);
                $text = str_replace("Comment: ", "", $comment_parts[1]);
                ?>
                <div class="comment">
                    <p class="name"><?php echo $name; ?></p>
                    <p class="text"><?php echo $text; ?></p>
                </div>
                <?php
            }
        }
```

### Вывоl
Этот код является основой для веб-сайта, построенного с использованием HTML, CSS и PHP. Мы разместили различные компоненты сайта в отдельных директориях и поддиректориях. Затем, используя функции include и require, мы объединили все эти элементы в единый сайт, который позволяет пользователям оставлять комментарии и читать комментарии других.